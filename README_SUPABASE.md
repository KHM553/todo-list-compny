# توثيق ربط مُحكم مع قاعدة بيانات Supabase

## نظرة عامة

تم ربط تطبيق مُحكم مع قاعدة بيانات Supabase لتخزين المهام بشكل دائم على السحابة بدلاً من الاعتماد فقط على التخزين المحلي (localStorage). هذا يتيح للمستخدمين الوصول إلى مهامهم من أي جهاز والاحتفاظ بنسخة احتياطية من البيانات.

## هيكل قاعدة البيانات

تم إنشاء جدول `tasks` في قاعدة بيانات Supabase بالأعمدة التالية:

- `id`: معرف فريد للمهمة (رقم صحيح)
- `text`: نص المهمة (نص)
- `completed`: حالة المهمة (منطقي: true/false)
- `created_at`: تاريخ إنشاء المهمة (طابع زمني)
- `completed_at`: تاريخ إكمال المهمة (طابع زمني، قد يكون فارغاً)
- `last_modified`: تاريخ آخر تعديل للمهمة (طابع زمني)

## الملفات المضافة/المعدلة

### 1. database.js (جديد)

ملف جديد يحتوي على وظائف الاتصال بقاعدة البيانات Supabase وإدارة المهام:

- `initDatabase()`: تهيئة الاتصال بقاعدة البيانات
- `fetchTasks()`: جلب جميع المهام من قاعدة البيانات
- `addTaskToDatabase()`: إضافة مهمة جديدة
- `updateTaskInDatabase()`: تحديث مهمة موجودة
- `deleteTaskFromDatabase()`: حذف مهمة
- `syncTasks()`: مزامنة المهام المحلية مع قاعدة البيانات

### 2. تعديلات على script.js

- تم تحديث وظائف إدارة المهام لتتفاعل مع قاعدة البيانات
- إضافة مزامنة المهام عند تحميل الصفحة
- تحديث وظائف إضافة/تعديل/حذف المهام لتعمل مع قاعدة البيانات

### 3. تعديلات على index.html

- إضافة استدعاء ملف database.js كوحدة (module)
- تحويل استدعاء script.js إلى وحدة (module) للسماح باستيراد الوظائف

## كيفية الاستخدام

1. عند تحميل التطبيق، يتم تلقائياً مزامنة المهام المحلية مع قاعدة البيانات
2. أي تغييرات تتم على المهام (إضافة، تعديل، حذف) يتم حفظها في كل من التخزين المحلي وقاعدة البيانات
3. في حالة عدم توفر اتصال بالإنترنت، يستمر التطبيق في العمل باستخدام التخزين المحلي

## معلومات الاتصال بقاعدة البيانات

- عنوان Supabase: `https://oxtbiidyhsomyubkiyta.supabase.co`
- مفتاح API: تم تضمينه في ملف database.js
- اتصال PostgreSQL المباشر: `postgresql://postgres:[YOUR-PASSWORD]@db.oxtbiidyhsomyubkiyta.supabase.co:5432/postgres`
  - ملاحظة: يجب استبدال `[YOUR-PASSWORD]` بكلمة المرور الخاصة بك عند استخدام الاتصال المباشر

## ملاحظات هامة

- يجب إنشاء جدول `tasks` في قاعدة بيانات Supabase قبل استخدام التطبيق
- في حالة وجود مشاكل في الاتصال بقاعدة البيانات، يتم الاعتماد على التخزين المحلي كنسخة احتياطية
- يمكن تعديل إعدادات الاتصال بقاعدة البيانات في ملف database.js